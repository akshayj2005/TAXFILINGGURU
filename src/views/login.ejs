<!doctype html>
<html lang="en" class="h-full">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Resident Login - Tax Filing Guru</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="css/styles.css">

  <link rel="icon" href="assets/images/favicon/favicon.ico" type="image/x-icon">
  <link rel="shortcut icon" href="assets/images/favicon/favicon.icon" type="image/x-icon">
  <link rel="apple-touch-icon" href="assets/images/favicon/apple-touch-icon.png">
</head>

<body class="h-full overflow-auto">
  <!-- Header -->
  <%- include('partials/header') %>
    <%- include('partials/elements') %>
      <!-- Client Login button (desktop) - Fixed position -->

      <!-- Page Heading -->

      <section class="w-full hero-bg pt-10 pb-10 px-4 relative">
        <div class="max-w-7xl mx-auto relative z-10 text-center">
          <h2 id="page-title" class="text-4xl md:text-5xl font-bold text-white mb-4">
            Login Into Your Resident Account
          </h2>
          <p id="page-subtitle" class="text-gray-100">
            Login to manage your tax filings and access personalized services.
          </p>
        </div>
      </section>
      <main class="w-full py-10 md:py-20 px-4 bg-gray-50">
        <div class="max-w-7xl mx-auto">
          <!-- Registration Card -->
          <div class="bg-white rounded-2xl shadow-lg overflow-hidden grid md:grid-cols-2">

            <!-- LEFT IMAGE PAMPHLET -->
            <div id="pamphlet"
              class="hidden md:flex items-center justify-center relative bg-cover bg-center min-h-[520px]">

            </div>

            <!-- RIGHT FORM -->
            <div class="p-10">

              <h3 class="text-2xl font-bold text-gray-900 mb-6">
                Login to Your Account
              </h3>

              <form id="loginForm" class="space-y-5">

                <input id="userid" required placeholder="User ID*"
                  class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 outline-none">

                <input id="loginPassword" type="password" required placeholder="Password*"
                  class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 outline-none">

                <button class="w-full py-3 rounded-lg bg-blue-600 text-white font-bold hover:bg-blue-700 transition">
                  Login
                </button>

                <div class="flex justify-between text-sm">
                  <button type="button" onclick="openForgotPassword()" class="text-blue-600 hover:underline">
                    Forgot Password?
                  </button>
                  <button type="button" onclick="openForgotUserId()" class="text-blue-600 hover:underline">
                    Forgot User ID?
                  </button>
                  <button type="button" onclick="newCustomerAlert()" class="text-blue-600 hover:underline">
                    New Customer? Click Here
                  </button>


                </div>

              </form>

            </div>
          </div>
          <div id="forgotPasswordModal" class="fixed inset-0 bg-black/60 hidden flex items-center justify-center z-50">

            <div class="bg-white rounded-xl p-8 w-full max-w-md relative">
              <button onclick="closeForgotPassword()" class="absolute top-3 right-3 text-gray-500">‚úï</button>

              <h3 class="text-xl font-bold mb-4">Forgot Password</h3>

              <input id="fp_userid" placeholder="Enter User ID" class="w-full mb-3 px-4 py-3 border rounded-lg">

              <button onclick="sendOtp()" class="w-full bg-blue-600 text-white py-2 rounded-lg mb-4">
                Send OTP
              </button>

              <input id="fp_otp" placeholder="Enter OTP" class="w-full mb-3 px-4 py-3 border rounded-lg">

              <input id="fp_newpass" type="password" placeholder="New Password"
                class="w-full mb-3 px-4 py-3 border rounded-lg">

              <button onclick="resetPassword()" class="w-full bg-green-600 text-white py-2 rounded-lg">
                Reset Password
              </button>
            </div>
          </div>
          <div id="forgotUserIdModal" class="fixed inset-0 bg-black/60 hidden flex items-center justify-center z-50">

            <div class="bg-white rounded-xl p-8 w-full max-w-md relative">
              <button onclick="closeForgotUserId()" class="absolute top-3 right-3 text-gray-500">‚úï</button>

              <h3 class="text-xl font-bold mb-4">Forgot User ID</h3>

              <input placeholder="First Name *" class="w-full mb-3 px-4 py-3 border rounded-lg">
              <input placeholder="Last Name *" class="w-full mb-3 px-4 py-3 border rounded-lg">
              <input placeholder="Email or Phone *" class="w-full mb-4 px-4 py-3 border rounded-lg">

              <button onclick="sendUserId()" class="w-full bg-blue-600 text-white py-2 rounded-lg">
                Get User ID
              </button>
            </div>
          </div>


        </div>
      </main>

      </div>
      <script>
        const type = new URLSearchParams(window.location.search).get("type");

        const pamphlet = document.getElementById("pamphlet");
        const heroTitle = document.getElementById("page-title");
        const heroSubtitle = document.getElementById("page-subtitle");


        if (type === "nri") {
          pamphlet.style.backgroundImage = "url('images/pamphlet-nri.jpg')";
          heroTitle.innerText = "NRI Login";
          heroSubtitle.innerText =
            "Specialized tax filing for foreign income, DTAA & global compliance. \n Expert handling of overseas income and Indian tax obligations.";
          document.title = "NRI Login - Tax Filing Guru";
        } else {
          pamphlet.style.backgroundImage = "url('images/pamphlet-resident.jpg')";
        }
        document.getElementById("loginForm").addEventListener("submit", function (e) {
          e.preventDefault();

          const userId = document.getElementById("userid").value.trim();
          const password = document.getElementById("loginPassword").value.trim();

          if (!userId || !password) {
            alert("‚ùå Please enter both User ID and Password.");
            return;
          }

          // ----------------------------
          // DEFAULT CREDENTIALS
          // ----------------------------
          const credentials = {
            resident: {
              userid: "resident",
              password: "resident123"
            },
            nri: {
              userid: "nri",
              password: "nri123"
            }
          };

          // ----------------------------
          // LOGIN TYPE FROM URL
          // ----------------------------
          const type = new URLSearchParams(window.location.search).get("type") || "resident";

          // ----------------------------
          // CREDENTIAL CHECK
          // ----------------------------
          if (
            type === "resident" &&
            userId === credentials.resident.userid &&
            password === credentials.resident.password
          ) {
            // Example: resident beginner
            localStorage.setItem("loginType", "residentbeginner");
            alert("‚úÖ Resident login successful!");
            onLoginSuccess();
            return;
          }

          if (
            type === "nri" &&
            userId === credentials.nri.userid &&
            password === credentials.nri.password
          ) {
            // Example: nri beginner
            localStorage.setItem("loginType", "nribeginner");
            alert("‚úÖ NRI login successful!");
            onLoginSuccess();
            return;
          }

          // ----------------------------
          // INVALID
          // ----------------------------
          alert("‚ùå Invalid User ID or Password.");
        });

        // ----------------------------
        // YOUR REDIRECT FUNCTION (UNCHANGED)
        // ----------------------------
        function onLoginSuccess() {
          const loginType = localStorage.getItem("loginType");

          if (loginType === "residentexisting") {
            window.location.href = "/existing-dashboard";
          }
          else if (loginType === "residentbeginner") {
            window.location.href = "/beginner-dashboard";
          }
          else if (loginType === "nriexisting") {
            window.location.href = "/existing-dashboard";
          }
          else if (loginType === "nribeginner") {
            window.location.href = "/beginner-dashboard";
          }
          else {
            window.location.href = "/";
          }

          localStorage.removeItem("loginType");
        }

        function openForgotPassword() {
          document.getElementById("forgotPasswordModal").classList.remove("hidden");
        }
        function closeForgotPassword() {
          document.getElementById("forgotPasswordModal").classList.add("hidden");
        }

        function openForgotUserId() {
          document.getElementById("forgotUserIdModal").classList.remove("hidden");
        }
        function closeForgotUserId() {
          document.getElementById("forgotUserIdModal").classList.add("hidden");
        }

        function sendOtp() {
          alert("üì© OTP sent to registered Email and Phone.");
        }

        function resetPassword() {
          alert("‚úÖ Password successfully changed.");
          closeForgotPassword();
        }

        function sendUserId() {
          alert("üìß Your User ID has been sent to Email and Phone.");
          closeForgotUserId();
        }
        function newCustomerAlert() {
          const proceed = confirm(
            "üëã New Customer?\n\n" +
            "You need to choose Resident or NRI before continuing.\n\n" +
            "Click OK to go to the main page."
          );

          if (proceed) {
            window.location.href = "/";
          }
        }
      </script>
      <script src="js/script.js"></script>
      <%- include('partials/footer') %>
</body>

</html>